Simular la atención en una Terminal de Micros que posee 3 puestos para hisopar a 150
pasajeros. En cada puesto hay una Enfermera que atiende a los pasajeros de acuerdo
con el orden de llegada al mismo. Cuando llega un pasajero se dirige al Recepcionista,
quien le indica qué puesto es el que tiene menos gente esperando. Luego se dirige al puesto
y espera a que la enfermera correspondiente lo llame para hisoparlo. Finalmente, se retira.

a) Implemente una solución considerando los procesos Pasajeros, Enfermera y
Recepcionista.

b) Modifique la solución anterior para que sólo haya procesos Pasajeros y Enfermera,
siendo los pasajeros quienes determinan por su cuenta qué puesto tiene menos
personas esperando.

Nota: suponga que existe una función Hisopar() que simula la atención del pasajero por
parte de la enfermera correspondiente.


A) #Tiene un error y es que las enfermeras se pueden llegar a quedar dormidas en linea  P(llegoMiFila[id])


Program:


cola filaRecepcion
sem mutexFilarecepcion = 1 

sem llegue = 0

cola filasEnfermeria[1..3] # Un arreglo de colas
sem mutexFilas[1..3](1) # exclusion para cada cola
sem llegoMiFila[1..3](0)  # Aviso a cada enfermera que hay un paciente

int cantEnFila[1..3]
sem mutexContadorFila = 1

sem pasajeroEspera[1..150](0)

bool jornadaTerminada = false
sem mutexFin = 1

Process Pasajero [id: 1..150]::
    P(mutexFilarecepcion)
    filaRecepcion.push(id)
    V(llegue) # llegue a recepcion
    P(pasajeroEspera[id]) # Espero a que me hisopen

Process Enfermera [id: 1..3]::
    P(mutexFilas[id]) # espero que no esten usando mi fila
    P(mutexFin) # Espero a que no haya nadie cambiando el bool
    int pasajero = -1
    while(!jornadaTerminada && !filasEnfermeria[id].empty())    
        V(mutexFin)
        V(mutexfilas[id])

        P(llegoMiFila[id]) # Espero a que llegue alguien a mi fila
        
        P(mutexFilas[id]) # voy a desencolar Pasajero
        pasajero = filasEnfermeria[id].pop()
        V(mutexFila[id])

        hisopar(pasajero) #lo hisopo
        V(pasajeroEspera[pasajero])

        P(mutexFilas[id])
        P(mutexFin)



Process Recepcionista::
    
    int atendi = 0 
    int idMin = 1
    int min 
    while atendi < 150
        min = 99999999

        P(llegue) # espero a que llegue alguien
        atendi++
        
        # calculo el minimo de las filas
        P(mutexContadorFila)

        for i = 1 to 3 
            if(cantEnFila[i] < min)
                idMin = i
                min = candEnFila[i]
        V(mutexContadorFila)

        
        P(mutexFilas[idMin])
        filasEnfermeria[idMin].push(id) # Lo pongo en la fila mas chica
        cantEnFila[idMin]++ # Aumento la cantidad de gente en esa fila
        V(mutexFila[idMin])

        V(llegoMiFila[idMin])
    P(mutexFin)
    jornadaTerminada = true
    V(mutexFin)
